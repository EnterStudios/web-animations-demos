<!--
Copyright 2012 Google Inc. All Rights Reserved.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<!DOCTYPE html>

<meta name="viewport" content="width=device-width, height=device-height, user-scalable=false;">

<script src="components/webcomponentsjs/webcomponents.js"></script>
<link href="https://fonts.googleapis.com/css?family=RobotoDraft:300,400,500|Inconsolata" rel="stylesheet" type="text/css">
<link rel="import" href="components/core-ajax/core-ajax.html"></link>
<link rel="import" href="components/core-menu/core-menu.html"></link>
<link rel="import" href="components/core-icon/core-icon.html"></link>
<link rel="import" href="components/core-item/core-item.html"></link>
<link rel="import" href="components/core-scaffold/core-scaffold.html"></link>
<link rel="import" href="components/core-header-panel/core-header-panel.html"></link>
<link rel="import" href="components/paper-button/paper-button.html"></link>

<style>
body {
  font-family: RobotoDraft,Helvetica,Arial,sans-serif;
  font-size: 16px;
  font-weight: 300;
}
</style>

<polymer-element name="web-animations-demo-card" attributes="demo">
  <template>
    <style>
    :host {
      display: block;
      position: relative;
      width: 300px;
      height: 230px;
      flex-grow: 1;
    }
    #card {
      width: 100%;
      height: 100%;
      position: relative;
      background-position: center;
      background-repeat: no-repeat;
      background-size: 300px auto;
      cursor: pointer;

      /** force layer */
      -webkit-transform: translateZ(0);
      transform: translateZ(0);
      will-change: transform;

      /** fade out card unless hovered */
      -webkit-filter: grayscale(1) contrast(0.75);
      -webkit-filter: grayscale(100%) contrast(75%);
      -moz-filter: grayscale(100%) contrast(75%);
      filter: gray;
      filter: grayscale(100%) contrast(75%);
    }
    #card h3 {
      visibility: hidden;
      position: absolute;
      margin: 0;
      bottom: 12px;
      left: 16px;
      font-weight: 500;
      color: black;
      -webkit-user-select: none;
      user-select: none;
    }
    #card.dark h3 {
      color: white;
    }
    #card:hover {
      -webkit-filter: none;
      -moz-filter: none;
      filter: none;
    }
    #card:hover h3 {
      visibility: visible;
    }

    </style>
    <div id="card">
      <h3>{{demo.name}}</h3>
    </div>
  </template>
  <script>
Polymer('web-animations-demo-card', {
  demo: null,

  updateShade: function() {
    var card = this.$.card;
    card.style.backgroundColor = this.demo.shade;
    card.style.backgroundImage = this.demo.preview ? 'url(' + this.demo.preview + ')' : null;
    card.classList.toggle('dark', this.demo.darkTheme);
  },

  ready: function() {
    // TODO: listen to 'demo' attribute change
    this.updateShade();
  }
});
  </script>
</polymer-element>

<polymer-element name="web-animations-demos" attributes="model">
  <template>
    <style>
    h2 {
      color: #3367d6;
      font-size: 24px;
      font-weight: 300;
    }
    core-menu {
      margin: 12px 0;
    }
    core-item {
      padding: 0 20px;
      font-weight: 400;
      color: #666;
      font-size: 16px;
      line-height: 32px;
    }
    core-item paper-ripple {
      color: #666;
    }
    core-item.core-selected {
      color: #0092f3;
      font-weight: initial;
    }
    core-selector {
      display: flex;
      flex-wrap: wrap;
    }
    iframe {
      position: absolute;
      height: 100%;
      width: 100%;
      border: 0;
    }
    paper-button {
      background: rgba(0, 0, 0, 0.1);
      font-weight: 400;
      min-width: 100px;
      color: #222;
      z-index: 1;
    }
    paper-button.dark {
      background: rgba(255, 255, 255, 0.1);
      color: #ccc;
    }
    paper-button#switch {
      position: absolute;
      top: 0;
      right: 0;
      margin: 24px;
    }
    div[fit] {
      overflow: scroll;
    }
    pre {
      margin: 0;
      padding: 16px 24px;
      font-family: "Inconsolata", monospace;
    }
    </style>
    <core-scaffold id="scaffold">
      <core-header-panel navigation flex mode="seamed">
        <core-toolbar>Web Animations</core-toolbar>
        <core-menu theme="core-light-theme" selected={{selectedHash}} valueattr="label" on-core-select={{selectAction}}>
          <template repeat={{model}}>
            <core-item label={{name}} data-hash="{{hash}}">
              <paper-ripple class="menu" fit=""></paper-ripple>
            </core-item>
          </template>
        </core-menu>
      </core-header-panel>

      <div tool>{{selected.name}}</div>

      <template if="{{selected}}">
        <paper-button id="switch" on-tap="{{handleSwitch}}" class="{{ {dark: selected.darkTheme && !showCode} | tokenList }}">
          <template if="{{showCode}}">
            Demo
          </template>
          <template if="{{!showCode}}">
            Code
          </template>
        </paper-button>
      </template>

      <div fit>
        <template if="{{selected}}">
          <template if="{{showCode}}">
            <core-ajax url="{{selected.path}}" handleAs="text" response="{{sampleCode}}" auto></core-ajax>
            <pre>{{sampleCode}}</pre>
          </template>
          <template if="{{!showCode}}">
            <!-- TODO: iframe doesn't autofocus -->
            <iframe id="display" src="{{selected.path}}"></iframe>
          </template>

          <div hidden>
            <template repeat="{{selected.header}}">
              <p>{{}}</p>
            </template>
            <template repeat="{{selected.description}}">
              <p>{{}}</p>
            </template>
          </div>

        </template>

        <template if="{{!selected}}">
          <core-selector on-core-select={{selectAction}}>
            <template repeat="{{model}}">
              <web-animations-demo-card data-hash="{{hash}}" demo="{{}}">
              </web-animations-demo-card>
            </template>
          </core-selector>
        </template>

      </div><!-- div fit -->
    </core-scaffold>
  </template>
</polymer-element>

<script>
Polymer('web-animations-demos', {
  /**
   * Whether to show code (as opposed to the demo).
   *
   * @attribute showCode
   * @type boolean
   * @default false
   */
  showCode: false,

  /**
   * The selected sample's HTML.
   *
   * @attribute sampleCode
   * @type String
   * @default null
   */
  sampleCode: null,

  selected: null,
  selectedHash: null,
  selectAction: function(e, detail) {
    if (detail.isSelected) {
      window.location.hash = detail.item.dataset.hash;
    }
    this.$.scaffold.closeDrawer()
  },
  hashchange: function() {
    var hash = window.location.hash;

    for (var i = 0; i < this.model.length; i++) {
      var demo = this.model[i];
      if (demo.hash == hash) {
        this.selected = demo;
        this.selectedHash = demo.hash;
        return;
      }
    }

    if (!this.selected) {
      // TODO: Allow selection of a master page option that showcases all
      // demos.
      this.selected = null;
      this.selectedHash = null;
    }
  },
  ready: function() {
    window.addEventListener('hashchange', this.hashchange.bind(this));
    this.hashchange();
  },
  handleSwitch: function() {
    this.showCode = !this.showCode;
  }
});
</script>

<web-animations-demos></web-animations-demos>
<script src="demos.js"></script>
<script>
function normalizeDemo(demo) {
  if (!demo.path) {
    demo.path = demo.name.toLowerCase();
  }
  demo.hash = '#' + demo.path;
  if (typeof demo.description == 'string') {
    demo.description = [demo.description];
  }
  if (typeof demo.header == 'string') {
    demo.header = [demo.header];
  }

  if (!demo.shade) {
    var hue = Math.random() * 360;
    demo.shade = 'hsl(' + hue + ', 85%, 67%)';
  }
}
demos.forEach(normalizeDemo);

document.querySelector('web-animations-demos').model = demos;
</script>
</html>
